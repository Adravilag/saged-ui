---
interface Prop {
  name: string;
  type: string;
  default: string;
  description: string;
}

interface Event {
  name: string;
  description: string;
  type: string;
}

interface Slot {
  name: string;
  description: string;
}

interface Method {
  name: string;
  description: string;
  returns: string;
}

interface Props {
  id: string;
  title: string;
  tag: string;
  description?: string;
  docsUrl?: string;
  props?: Prop[];
  events?: Event[];
  slots?: Slot[];
  methods?: Method[];
}

import PropsTable from './PropsTable.astro';

const { id, title, tag, description, docsUrl, props = [], events = [], slots = [], methods = [] } = Astro.props;
const hasApiDocs = props.length > 0 || events.length > 0 || slots.length > 0 || methods.length > 0;

// Get base URL and resolve docs path (ensure trailing slash)
const base = import.meta.env.BASE_URL.endsWith('/') ? import.meta.env.BASE_URL : `${import.meta.env.BASE_URL}/`;
const resolvedDocsUrl = docsUrl ? `${base}${docsUrl.startsWith('/') ? docsUrl.slice(1) : docsUrl}` : undefined;
---

<article class="card" id={id}>
  <header class="card-header">
    <div class="card-header-left">
      <div class="card-icon">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2"/>
          <path d="M3 9h18"/>
        </svg>
      </div>
      <div class="card-info">
        <h2 class="card-title">{title}</h2>
        {description && <p class="card-description">{description}</p>}
      </div>
    </div>
    <div class="card-header-right">
      {resolvedDocsUrl && (
        <a href={resolvedDocsUrl} class="card-docs-link" title="Ver documentación completa">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
          </svg>
          <span>Docs</span>
        </a>
      )}
      <code class="card-tag">&lt;{tag}&gt;</code>
    </div>
  </header>
  <div class="card-content">
    <div class="card-demo">
      <slot />
    </div>
  </div>
  {hasApiDocs && (
    <div class="card-api">
      <button class="api-toggle" data-expanded="false">
        <svg class="toggle-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
        </svg>
        <span class="toggle-text">API Reference</span>
        <span class="toggle-summary">
          {props.length > 0 && <span class="summary-item">{props.length} props</span>}
          {events.length > 0 && <span class="summary-item">{events.length} eventos</span>}
          {slots.length > 0 && <span class="summary-item">{slots.length} slots</span>}
          {methods.length > 0 && <span class="summary-item">{methods.length} métodos</span>}
        </span>
        <svg class="chevron-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="m6 9 6 6 6-6"/>
        </svg>
      </button>
      <div class="api-content">
        <PropsTable props={props} events={events} slots={slots} methods={methods} compact={true} />
      </div>
    </div>
  )}
</article>

<style>
  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    overflow: hidden;
    transition: all var(--transition-normal);
    width: 90%;
    max-width: none;
  }

  .card:hover {
    border-color: var(--border-muted);
    box-shadow: var(--shadow-md);
  }

  .card-header {
    padding: 1rem 1.25rem;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    background: var(--surface);
  }

  .card-header-left {
    display: flex;
    align-items: center;
    gap: 0.875rem;
  }

  .card-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    background: var(--accent-soft);
    border-radius: var(--radius-md);
    color: var(--accent);
  }

  .card-info {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
  }

  .card-title {
    font-size: 0.9375rem;
    font-weight: 600;
    margin: 0;
    color: var(--text);
  }

  .card-description {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin: 0;
  }

  .card-header-right {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .card-docs-link {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.25rem 0.625rem;
    font-size: 0.6875rem;
    font-weight: 500;
    color: var(--text-muted);
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    text-decoration: none;
    transition: all var(--transition-fast);
  }

  .card-docs-link:hover {
    color: var(--accent);
    border-color: var(--accent);
    background: var(--accent-soft);
  }

  .card-tag {
    font-size: 0.6875rem;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    background: var(--bg);
    border: 1px solid var(--border);
    padding: 0.25rem 0.625rem;
    border-radius: var(--radius-sm);
    color: var(--accent);
    font-weight: 500;
  }

  /* Content Layout */
  .card-content {
    display: flex;
    background: var(--bg);
  }

  .card-demo {
    flex: 1;
    padding: 1.5rem 1.25rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 1.5rem;
    min-width: 0;
  }

  /* API Section */
  .card-api {
    border-top: 1px solid var(--border);
    background: var(--surface);
  }

  .api-toggle {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.25rem;
    background: transparent;
    border: none;
    cursor: pointer;
    color: var(--text-muted);
    font-size: 0.75rem;
    font-weight: 500;
    text-align: left;
    transition: all var(--transition-fast);
  }

  .api-toggle:hover {
    background: var(--surface-hover);
    color: var(--text);
  }

  .api-toggle .toggle-icon {
    color: var(--accent);
  }

  .api-toggle .toggle-text {
    font-weight: 600;
    color: var(--text);
  }

  .api-toggle .toggle-summary {
    display: flex;
    gap: 0.5rem;
    margin-left: auto;
    margin-right: 0.5rem;
  }

  .api-toggle .summary-item {
    font-size: 0.625rem;
    padding: 0.125rem 0.375rem;
    background: var(--bg);
    border-radius: var(--radius-sm);
    color: var(--text-muted);
  }

  .api-toggle .chevron-icon {
    transition: transform var(--transition-fast);
  }

  .api-toggle[data-expanded="true"] .chevron-icon {
    transform: rotate(180deg);
  }

  .api-content {
    display: none;
    padding: 1rem 1.25rem;
    background: var(--bg);
    border-top: 1px solid var(--border-subtle);
  }

  .api-toggle[data-expanded="true"] + .api-content {
    display: block;
    animation: slideDown 0.2s ease-out;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @media (max-width: 768px) {
    .card {
      width: 95%;
    }

    .api-toggle .toggle-summary {
      display: none;
    }
  }
</style>

<script>
  document.querySelectorAll('.api-toggle').forEach(btn => {
    btn.addEventListener('click', () => {
      const expanded = btn.getAttribute('data-expanded') === 'true';
      btn.setAttribute('data-expanded', String(!expanded));
    });
  });
</script>
